<!DOCTYPE html>
<html>
<head>
    <title>Easy Auth App</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; display: flex; justify-content: center; margin-top: 50px; }
        .box { background: white; padding: 30px; border-radius: 12px; shadow: 0 4px 6px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        input { width: 90%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; }
        button { width: 95%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-reg { background: #6c757d; color: white; }
        .btn-log { background: #007bff; color: white; }
        #status { margin-top: 20px; color: #d9534f; font-weight: bold; }
    </style>
</head>
<body>
    <div class="box">
        <h2>Welcome</h2>
        <input type="text" id="user" placeholder="Username">
        <input type="password" id="pass" placeholder="Password">
        <button class="btn-reg" onclick="handleAuth('/register')">Register New Account</button>
        <button class="btn-log" onclick="handleAuth('/login')">Login</button>
        <hr>
        <button style="background:#28a745; color:white;" onclick="checkSecret()">Visit VIP Protected Area</button>
        <div id="status"></div>
    </div>

    <script>
        async function handleAuth(route) {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            
            const response = await fetch(route, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: u, password: p})
            });
            const data = await response.json();

            if (data.token) {
                // THE SECRET SAUCE: This saves the token in the browser's memory
                localStorage.setItem('my_secret_token', data.token);
                document.getElementById('status').innerText = "Logged in! Token saved in browser.";
            } else {
                document.getElementById('status').innerText = data.msg;
            }
        }

        async function checkSecret() {
            // Automatically pull the token from the "pocket"
            const token = localStorage.getItem('my_secret_token');
            
            const response = await fetch('/protected', {
                method: 'GET',
                headers: {'x-access-token': token}
            });
            const data = await response.json();
            document.getElementById('status').innerText = data.msg || "Access Denied!";
        }
    </script>
</body>
</html>
